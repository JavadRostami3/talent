# 🔄 روند کامل Workflow سیستم پذیرش

## 📌 نقش‌های سیستم

```
1️⃣ APPLICANT (داوطلب)
   - پرکردن فرم‌ها
   - آپلود مدارک
   - ارسال پرونده
   - دریافت نتیجه

2️⃣ UNIVERSITY_ADMIN (مسئول دانشگاه)
   - بررسی صحت مدارک شناسایی
   - بررسی صحت مدارک تحصیلی
   - تایید / تایید با نقص / رد پرونده
   - ارجاع به مسئول دانشکده (در صورت تایید)

3️⃣ FACULTY_ADMIN (مسئول دانشکده)
   - بررسی پرونده‌های تایید شده
   - پذیرش / عدم پذیرش در رشته‌های انتخابی
   - اعلام نتیجه نهایی

4️⃣ SUPERADMIN (سوپر ادمین)
   - دسترسی کامل به همه بخش‌ها
   - مدیریت کاربران و دسترسی‌ها
```

---

## 🚀 فلوچارت کامل روند (استعداد درخشان ارشد)

```
┌─────────────────────────────────────────────────────────────┐
│                      مرحله 1: داوطلب                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
            [ثبت‌نام اولیه - Status: NEW]
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.1 انتخاب رشته‌ها (حداکثر 3 رشته با اولویت)             │
│  Status: PROGRAM_SELECTED                                   │
│  - فیلتر بر اساس: گروه آموزشی، گرایش، رشته کارشناسی        │
│  - جستجوی نام رشته                                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.2 پرکردن فرم 1 - اطلاعات شخصی                           │
│  Status: PERSONAL_INFO_COMPLETED                            │
│  فیلدها:                                                    │
│  - نام و نام خانوادگی                                       │
│  - کد ملی (از قبل پر شده)                                  │
│  - نام پدر                                                  │
│  - شماره شناسنامه                                           │
│  - شماره سریال شناسنامه                                     │
│  - محل صدور شناسنامه                                        │
│  - جنسیت (رادیو: زن/مرد)                                    │
│  - سال تولد (دراپداون)                                      │
│  - محل تولد                                                 │
│  - نشانی محل سکونت دائم                                     │
│  - تلفن تماس                                                │
│  - تلفن همراه                                               │
│  - پست الکترونیک                                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.3 آپلود مدارک شناسایی                                   │
│  Status: IDENTITY_DOCS_UPLOADED                             │
│  مدارک الزامی:                                              │
│  ✅ عکس پرسنلی (PERSONAL_PHOTO)                             │
│  ✅ تصویر کارت ملی (NATIONAL_CARD)                          │
│  ✅ تصویر شناسنامه (ID_CARD)                                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.4 پرکردن فرم 2 - اطلاعات تحصیلی                         │
│  Status: EDU_INFO_COMPLETED                                 │
│  فیلدها:                                                    │
│  - وضعیت تحصیل (در حال تحصیل / فارغ‌التحصیل)               │
│  - دانشگاه (با قابلیت جستجو)                                │
│  - رشته تحصیلی (با قابلیت جستجو)                           │
│  - تعداد واحد گذرانده                                       │
│  - تعداد نیمسال گذرانده                                     │
│  - معدل کارشناسی                                            │
│  - تعداد دانشجو دوره                                        │
│  - وضعیت رتبه                                               │
│  - تاریخ شروع دوره                                          │
│  - تاریخ پایان دوره                                         │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.5 آپلود مدارک تحصیلی                                    │
│  Status: EDU_DOCS_UPLOADED                                  │
│  مدارک الزامی:                                              │
│  ✅ مدرک کارشناسی (BSC_CERT)                                │
│  ✅ ریزنمرات کارشناسی (TRANSCRIPT)                          │
│  مدارک اختیاری:                                             │
│  🔹 گواهی دانشجو ممتاز (EXCELLENCE_CERT)                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  1.6 ثبت سوابق علمی (اختیاری)                              │
│  انواع سوابق:                                               │
│  - مقاله (ARTICLE)                                          │
│  - کتاب (BOOK)                                              │
│  - مقاله کنفرانسی (CONFERENCE)                              │
│  - اختراع (PATENT)                                          │
│  - سایر (OTHER)                                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
            [ارسال نهایی - Status: SUBMITTED]
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                  مرحله 2: مسئول دانشگاه                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
      [Status: UNDER_UNIVERSITY_REVIEW]
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  2.1 بررسی مدارک شناسایی                                   │
│  FormReview (document_type=IDENTITY_DOCS)                   │
│                                                              │
│  گزینه‌های بررسی:                                           │
│  ✅ APPROVED - تایید شده                                    │
│  ⚠️  APPROVED_WITH_DEFECT - تاییدشده با نقص                 │
│      └─ مشخص کردن موارد نقص با تیک                         │
│  ❌ REJECTED - فرم تایید نشده                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  2.2 بررسی مدارک تحصیلی                                    │
│  FormReview (document_type=EDUCATION_DOCS)                  │
│                                                              │
│  گزینه‌های بررسی:                                           │
│  ✅ APPROVED - تایید شده                                    │
│  ⚠️  APPROVED_WITH_DEFECT - تاییدشده با نقص                 │
│      └─ مشخص کردن موارد نقص با تیک                         │
│  ❌ REJECTED - فرم تایید نشده                               │
└─────────────────────────────────────────────────────────────┘
                              │
                              ↓
                     [تصمیم‌گیری نهایی]
                              │
         ┌────────────────────┼────────────────────┐
         ↓                    ↓                    ↓
    ✅ تایید          ⚠️ تایید با نقص         ❌ رد
         │                    │                    │
         │                    │                    │
         │                    ↓                    ↓
         │         [RETURNED_FOR_CORRECTION]  [REJECTED_BY_UNIVERSITY]
         │           برگشت به داوطلب            پایان کار
         │           برای اصلاح نواقص
         │                    │
         │                    └──> [داوطلب اصلاح می‌کند]
         │                                │
         │                                └──> [ارسال مجدد]
         │
         ↓
[APPROVED_BY_UNIVERSITY]
Application.university_review_status = APPROVED
         │
         ↓
┌─────────────────────────────────────────────────────────────┐
│                   مرحله 3: مسئول دانشکده                    │
└─────────────────────────────────────────────────────────────┘
         │
         ↓
[Status: UNDER_FACULTY_REVIEW]
         │
         ↓
┌─────────────────────────────────────────────────────────────┐
│  3.1 بررسی انتخاب‌های رشته داوطلب                          │
│  ApplicationChoice (برای هر رشته انتخابی)                  │
│                                                              │
│  مسئول دانشکده برای هر رشته تصمیم می‌گیرد:                │
│  ✅ ACCEPTED - پذیرفته شده                                  │
│  ❌ REJECTED - پذیرفته نشده                                 │
│  ⏳ WAITING - ذخیره (لیست انتظار)                          │
│                                                              │
│  مثال:                                                       │
│  - اولویت 1: فلسفه و کلام (روزانه) ✅ ACCEPTED              │
│  - اولویت 2: فلسفه و کلام (شبانه) ❌ REJECTED               │
│  - اولویت 3: الهیات ⏳ WAITING                              │
└─────────────────────────────────────────────────────────────┘
         │
         ↓
[Status: FACULTY_REVIEW_COMPLETED]
Application.faculty_review_completed = True
         │
         ↓
┌─────────────────────────────────────────────────────────────┐
│                   مرحله 4: اعلام نتیجه                      │
└─────────────────────────────────────────────────────────────┘
         │
         ↓
[Status: COMPLETED]
Application.admission_result_published_at = now()
         │
         ↓
   [اعلام به داوطلب]
         │
         ↓
┌─────────────────────────────────────────────────────────────┐
│  نتیجه نهایی:                                               │
│  - پذیرفته شده در رشته X                                   │
│  - رد شده در همه رشته‌ها                                   │
│  - در لیست انتظار رشته Y                                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 جدول وضعیت‌های Application

| Status | توضیح | نقش | مرحله |
|--------|-------|-----|-------|
| `NEW` | ثبت‌نام اولیه | داوطلب | 1 |
| `PROGRAM_SELECTED` | رشته انتخاب شد | داوطلب | 1.1 |
| `PERSONAL_INFO_COMPLETED` | اطلاعات شخصی تکمیل شد | داوطلب | 1.2 |
| `IDENTITY_DOCS_UPLOADED` | مدارک شناسایی آپلود شد | داوطلب | 1.3 |
| `EDU_INFO_COMPLETED` | اطلاعات تحصیلی تکمیل شد | داوطلب | 1.4 |
| `EDU_DOCS_UPLOADED` | مدارک تحصیلی آپلود شد | داوطلب | 1.5 |
| `SUBMITTED` | ارسال شده (منتظر بررسی) | داوطلب | 1.6 |
| `UNDER_UNIVERSITY_REVIEW` | در حال بررسی توسط مسئول دانشگاه | مسئول دانشگاه | 2 |
| `APPROVED_BY_UNIVERSITY` | تایید شده توسط مسئول دانشگاه | مسئول دانشگاه | 2 ✅ |
| `REJECTED_BY_UNIVERSITY` | رد شده توسط مسئول دانشگاه | مسئول دانشگاه | 2 ❌ |
| `RETURNED_FOR_CORRECTION` | برگشت برای اصلاح نواقص | مسئول دانشگاه | 2 ⚠️ |
| `UNDER_FACULTY_REVIEW` | در حال بررسی توسط مسئول دانشکده | مسئول دانشکده | 3 |
| `FACULTY_REVIEW_COMPLETED` | بررسی دانشکده تکمیل شد | مسئول دانشکده | 3 ✅ |
| `COMPLETED` | تکمیل شده (نتیجه اعلام شد) | سیستم | 4 |

---

## 🔐 دسترسی‌های نقش‌ها

### 1️⃣ **APPLICANT (داوطلب)**
```python
✅ مشاهده پرونده‌های خودش
✅ ویرایش اطلاعات (تا قبل از ارسال)
✅ آپلود/حذف مدارک (تا قبل از ارسال)
✅ ارسال پرونده
✅ مشاهده وضعیت بررسی
✅ مشاهده نتیجه نهایی
❌ ویرایش بعد از ارسال (مگر در صورت برگشت)
```

### 2️⃣ **UNIVERSITY_ADMIN (مسئول دانشگاه)**
```python
✅ مشاهده همه پرونده‌های ارسال شده
✅ بررسی مدارک شناسایی
✅ بررسی مدارک تحصیلی
✅ تایید / تایید با نقص / رد
✅ ارجاع به مسئول دانشکده (در صورت تایید)
✅ مشاهده تاریخچه تغییرات
❌ تغییر وضعیت پذیرش در رشته‌ها (فقط مسئول دانشکده)
```

### 3️⃣ **FACULTY_ADMIN (مسئول دانشکده)**
```python
✅ مشاهده پرونده‌های تایید شده توسط مسئول دانشگاه
✅ مشاهده رشته‌های مربوط به دانشکده خودش
✅ پذیرش / عدم پذیرش در هر رشته
✅ قرار دادن در لیست انتظار
✅ نوشتن نظر برای هر تصمیم
❌ بررسی مدارک (فقط مسئول دانشگاه)
❌ مشاهده پرونده‌های دانشکده‌های دیگر
```

### 4️⃣ **SUPERADMIN**
```python
✅ دسترسی کامل به همه بخش‌ها
✅ مدیریت کاربران
✅ تخصیص دسترسی‌ها
✅ مشاهده همه گزارش‌ها
```

---

## 🗂️ مدل‌های مرتبط

### **Application (پرونده اصلی)**
```python
- status: وضعیت کلی پرونده
- university_review_status: نتیجه بررسی مسئول دانشگاه
- university_reviewed_by: مسئول دانشگاه بررسی‌کننده
- university_reviewed_at: تاریخ بررسی
- faculty_review_completed: آیا دانشکده بررسی کرده؟
- faculty_reviewed_by: مسئول دانشکده بررسی‌کننده
- faculty_reviewed_at: تاریخ بررسی دانشکده
```

### **FormReview (بررسی مدارک)**
```python
- document_type: IDENTITY_DOCS یا EDUCATION_DOCS
- status: PENDING, APPROVED, APPROVED_WITH_DEFECT, REJECTED
- comment: نظر بررسی‌کننده
- defects: موارد نقص (JSON)
- reviewer: بررسی‌کننده
```

### **ApplicationChoice (انتخاب رشته)**
```python
- priority: اولویت (1، 2، 3)
- admission_status: PENDING, ACCEPTED, REJECTED, WAITING
- admission_note: نظر مسئول دانشکده
```

### **ApplicationWorkflowLog (تاریخچه)**
```python
- step_type: نوع مرحله
- description: توضیحات
- created_by: ایجادکننده
- created_at: تاریخ
```

---

## 🎯 نکات مهم

1. **تفکیک وظایف**: مسئول دانشگاه فقط بررسی می‌کند، مسئول دانشکده فقط پذیرش می‌دهد
2. **تایید با نقص**: داوطلب باید نواقص را اصلاح کرده و مجدد ارسال کند
3. **اولویت انتخاب**: مسئول دانشکده می‌تواند در چند رشته پذیرش دهد
4. **لیست انتظار**: امکان قرار دادن در لیست انتظار وجود دارد
5. **تاریخچه کامل**: همه تغییرات در `ApplicationWorkflowLog` ثبت می‌شود

---

## 📝 API Endpoints مورد نیاز

### **داوطلب:**
```
POST   /api/applications/create/              # ثبت‌نام اولیه
POST   /api/applications/{id}/select-programs/   # انتخاب رشته‌ها
PATCH  /api/applications/{id}/personal-info/     # اطلاعات شخصی
POST   /api/documents/upload/                    # آپلود مدارک
PATCH  /api/applications/{id}/education-info/    # اطلاعات تحصیلی
POST   /api/applications/{id}/submit/            # ارسال نهایی
GET    /api/applications/{id}/status/            # وضعیت پرونده
```

### **مسئول دانشگاه:**
```
GET    /api/admin/university/applications/                      # لیست پرونده‌ها
POST   /api/admin/university/applications/{id}/review-identity/ # بررسی مدارک شناسایی
POST   /api/admin/university/applications/{id}/review-education/ # بررسی مدارک تحصیلی
POST   /api/admin/university/applications/{id}/approve/         # تایید نهایی
POST   /api/admin/university/applications/{id}/reject/          # رد
POST   /api/admin/university/applications/{id}/return/          # برگشت برای اصلاح
```

### **مسئول دانشکده:**
```
GET    /api/admin/faculty/applications/                 # لیست پرونده‌های دانشکده
POST   /api/admin/faculty/applications/{id}/review/     # بررسی پذیرش
POST   /api/admin/faculty/choices/{id}/decision/        # تصمیم برای هر رشته
POST   /api/admin/faculty/applications/{id}/complete/   # تکمیل بررسی
```

---

این روند برای **استعداد درخشان ارشد** است. برای **دکتری** و **المپیاد** ممکن است تفاوت‌هایی وجود داشته باشد.
